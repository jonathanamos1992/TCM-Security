# SOC and it's role
Soc is a centralized unit within an organization that deals with secuirty issues, incidents and events.

### Monitor
-Continous observation for unusual activity
-Utilization of monitoring tools (IDS, SIEM, etc) for real-time visibility
-Early detections of potential security threats

### Detect 
-Confirm secuirty events identified during monitoring
-Utilize threat detection techniques
-Identify known indicators of comprimise

### Analyze
-Perform in-depth investigation to understand security incidents
-Examine affected systems build a timeline of events
-Trace tactics, techniques and procedures (TTP's)

### Respond
-Formulate a response plan based on findings
-Contain threats, mitigate impact, and restore normal operations
-Collaborate with internal teams and stakeholders

# Key Functions of a SOC

## Reactive

### Monitoring and Detection
- Network and system logs, alerts
- -SIEM, IDS, log analysis
- Alert triage

### Incident Response
-Investigate, contain, and mitigate threats
- Collect evidence and artifacts
- - Engage with stakeholders
 
### Forensic Analysis
- In-house or third party
- Determine cause and scope
- Preserve evidence and engage legal

### Malware Analysis
- In-house or third-party
- Sandbox or reverse engineer malware
- Study malware behavior
- Collect inidcators of compromise

## Proactive
### Threat Intelligence
- Gather and analyze intelligence
- Study emerging threats, vulnerabilities and attacks
- Feed intel into detection tools for proactive defense

### Threat Hunting
- Search for malicious activity or intrusions
- Logs, network traffic, endpoint telemetry
- Utilize threat intelligence to hunt for known indicators

### Vulnerability Management
- Identify and address vulnerabilities
- Scan, assess and patch
- Coordinate remediation activity

### Security Awareness Training
- Promote security awareness within the organization
- Educate best practcies, policies and procedures.
  
# Event Management
### Collection, normalization, analysis
-Generated by systems and devices

### Logs, alerts, endpoints
- Firewalls, IDS, antivirus, EDR, web servers, routers

### Identify abnormal or suspicious activities
-Rules and alerts on behavior, known malicious artifacts

### Security Information and Event Management (SIEM)

# Incident Management
### Incident Identification
- Event management escalation
- Detection mechanisms

### Incident Classification
- Severity, impact and nature

### Incident Investigation
- Gather evidence, determine scope

### Incident Containment
- Prevent further escalation

### Incident Eradication
- Remove evil

### Incident Recovery

# Detection Outcomes

### False Positive
- Incorrect identification of benign activity

### True Positive
- Correct Identification of a real security incident

### False Negative
- Failed detection of a real security threat

### True Negative
- Correct identification of benign activity

# SOC Metrics

### Mean Time to Detect (MTTD)
- Lower MTTD = faster detection

### Mean Time to Resolution (MTTR)
- Lower MTTR = More efficient IR

### Mean Time to Attend and Analyze (MTTA&A)
- Lower MTTA&A = reduced response latency

Incident Detection rate
Higher rate = better visibility and monitoring

False Positive Rates (FPR)
Lower rate = more accurate detection

False Negative Rates (FNR)
Lower rates = More accurate detection

Key Performance Indicators (KPIs)
- Measureable values to track performance

Key Risk Indicators (KRIs)
- Measureable values to assess risk

# SOC Tools 
## Security Information and Event Management (SIEM)
- Log management
- Real-time monitoring
- Alerting and Notification
- Incident Response
- Dashboards, Reports and Visualization
- Threrat Intelligence Integration
  
## Security Orchestration, Automation, and Response (SOAR)
### Orchestration
- Seemlessly collaborate and integrate between different security technologies (SIEM,Threat Intelligence, Firewalls, ACLs, Identity Access Management Systems) to automate tasks that require manual work.
- Workflows
- Collaboration

### Automation
- Alert Triage
- Artifact collection
- Data enrichment

### Incident Response
- Assess and prioritize

### Integration
- Threat Intelligence Platforms (TIPS), EDR's, firewalls, etc

### Analytics and Intelligence

### Reporting

# Phishing 

### Email Addresses

<img width="981" height="547" alt="image" src="https://github.com/user-attachments/assets/2cb3a031-8f31-4fc1-899c-e1b9b31ea736" />

<img width="990" height="541" alt="image" src="https://github.com/user-attachments/assets/fae4171e-be46-4c5a-a2b5-c5508d5ec182" />

### Mail Agents

<img width="976" height="553" alt="image" src="https://github.com/user-attachments/assets/a202be8e-101e-4b95-9678-9c90e96b4342" />

### Phishing Attack Types

<img width="983" height="551" alt="image" src="https://github.com/user-attachments/assets/ba8b2a1f-c044-4ef6-8e92-4b1fc8a570ee" />

### Anatomy of a URL
<img width="970" height="553" alt="image" src="https://github.com/user-attachments/assets/a6c065dc-bf2c-4db3-a289-dbad8a24097b" />

### Anatomy of a URL
In a typical email file, the actual body of the email consists of the MIME or Multi-Purpose Internet Mail Extension parts
- Alllows email to contain different types of content (plain text, HTML, images attachments)

Each part of an email is separated by a boundary 
<img width="977" height="558" alt="image" src="https://github.com/user-attachments/assets/95bbf765-8993-4072-8a94-3f3096324478" />

Content-Type:
Specify the type of content in the email body
<img width="372" height="32" alt="image" src="https://github.com/user-attachments/assets/ad28353c-c91a-4227-a31d-164b82b438e4" />

Content-Header Encoding:
Explains how the content is encoded for transmission.
<img width="319" height="21" alt="image" src="https://github.com/user-attachments/assets/e7848445-151b-48f4-a330-ec403c7d41a0" 
  (7bit, no encoding applied)/>

### Base64 
Method used to encode binary data into ASCII characters, making it suitable for transmission over text based channels like email
<img width="707" height="336" alt="image" src="https://github.com/user-attachments/assets/114ec1e1-1c35-4442-a99c-1290a6a08f76" />
== padding characters

## Encoding mechanisms

### HMTL Entity Encoding
Sequence of characters to represent specific HTML characters

HTML uses entities that are reserved for HTML syntax or characters that have specialized meanings
<img width="980" height="545" alt="image" src="https://github.com/user-attachments/assets/eec8da58-edb6-4b8f-a9d2-19f5841f5e86" />
<img width="985" height="551" alt="image" src="https://github.com/user-attachments/assets/c5dbceab-5783-4c96-8ac7-14bb8ddd2f03" />

### URL Encoding

Method used to convert characters into a format that can be transmitted over the internet
Often legitimate but attackers may attempt to encode URLS to bypass weaker spam filters

Works by replacing non-alphanumeric characters with a % followed by two digit hex value that represent character in ASCII character set
<img width="979" height="549" alt="image" src="https://github.com/user-attachments/assets/31d05cbb-1128-43ad-afa7-465767c5a03c" />

For the example, the text was also encoded with quoted-printable for three layers of encoding

<img width="676" height="259" alt="image" src="https://github.com/user-attachments/assets/754c804c-13f7-47ea-9b1c-a92aee6fe046" />

### Email Header and Sender Analysis

Received Headers
- Read bottom to top

Received-SPF: 
Sender Policy Framework: Mechanism that allows domain owners to specify which email servers are allowed to send emails on behalf of domain
Works by publsihign SPF records in DNS for a domain
SPF records contain a list of IP addresses or domain names of servers that aare aithorized to send emails for the domain.

To Check:

'nslookup -type=txt shodan.ip | grep -i spf'

or 

'dig TXT shodan.io | grep -i spf'
<img width="982" height="551" alt="image" src="https://github.com/user-attachments/assets/cd76f291-dd60-456b-b16c-7fa0979e667c" />

<img width="986" height="546" alt="image" src="https://github.com/user-attachments/assets/e26dfadc-75ea-4f6d-9073-d408a46d31c2" />
<img width="983" height="548" alt="image" src="https://github.com/user-attachments/assets/e524888e-ea3e-49cf-9984-3b8173b80b5c" />
<img width="990" height="556" alt="image" src="https://github.com/user-attachments/assets/37f680f0-f97f-4a4c-83fe-3ba830a61593" />

Doesn't verify if a sender is legitimate, but verifies that sender matches or is authorized by the domain specified in email's From address.
If an attacker registers their own domain, and sets up SPF record themselves or uses a service like Gmail or Yahoo, attacker will pass SPF check
Important to look into senders actual domain along with performing these authentication checks.

Actual Yahoo example
<img width="1142" height="333" alt="image" src="https://github.com/user-attachments/assets/6b0d3fa4-1471-4d7e-aa4a-64a1ba89c9f0" />

Looking at 'nslookup' command, we see the policy +all allows for any server to send mail on behalf of ishask.info
<img width="1156" height="103" alt="image" src="https://github.com/user-attachments/assets/353d0337-e8b9-4888-92be-15e26ddc08d7" />

### DomainKeys Identified Mail
Method used to authenticate the origin of email messages
Allows a receiver to verify that an email was sent from the domain it claims to be
Also that message content has not been tampered with during transit
Does this using Public Key Infrastructure of PKI

### DKIM
When email is sent from domain with DKIM enabled, sending mail server add digital signature to email header using unique private key associated with that domain
Public key published to the DNS record of the sending domian
Upon receving the email, recipients email server is going to retrieve the public key from senders DNS record and use it to veirfy DKIM signature.
If signature is valid and message content hasn't been tampered with, email is considered authentic and passes the check.

<img width="977" height="543" alt="image" src="https://github.com/user-attachments/assets/c5015f4d-2ada-49a1-b527-6b8909a0cb13" />

Doesn't evaluate content of email or intent behind
Establishes legitimacy of domain but not if domain is malicious or intentions of attacker

### Domain-based MEssage Authentication, Reporting and Conformance (DMARC)
Works alongside of SPF and DKIM to enchance overall authentication with additional reporting mechanisms
SPF and DKIM indiviually authenticate emails by verifying the sender's domain and ensuring message integrity,
DMARC adds an extra layer of control and visibility for domain owners.

ALlows domain owners to specify policies regarding how their emails should be handled if they fail SPF or DKIM checks
Only outlines what actions receiving email servers SHOULD take when they encounter emails that fail DMARC checks
Don't enforce compliance

Recipients mail servers can choose whether or not to honor DMARC policies.

<img width="1133" height="832" alt="image" src="https://github.com/user-attachments/assets/12fcd0d2-f2e5-4ddd-9410-ba4c0218a7a6" />
<img width="948" height="1470" alt="image" src="https://github.com/user-attachments/assets/e1f38858-ce86-4b5f-8fe3-73f3bb22d822" />


### URL Analysis

Step 1: Extract the URL from email content

- Open up the email in Sublime Text
- Can either CTRL-F search for 'http' and find link
  or
- Search for '<a' as in HTML, this is an anchor tag which is used for hyperlinks.

<img width="1131" height="690" alt="image" src="https://github.com/user-attachments/assets/37bdb462-fd81-4b73-b2af-64eb0a37a566" />

Advantage of this method is no chance of accidently misclicking on a link
Also won't miss any findings as long as we use the right search strings

Alternatively, we can use CyberChef to automatically extract URLs from an email file.
-Can either copy and paste from Sublime or Input file
<img width="1017" height="566" alt="image" src="https://github.com/user-attachments/assets/b945aa91-0201-49d2-9bce-c2c58b93abe7" />
<img width="1879" height="979" alt="image" src="https://github.com/user-attachments/assets/356b3f5c-0fbb-4989-9574-ec100e0259a1" />

This specific email was encoded with quoted-printabel encoding and URL is slpit between multiple lines so if we were to attempt to extract URL the normal way, it wouldn't work

First we needed to decode from quoted-printables
<img width="988" height="548" alt="image" src="https://github.com/user-attachments/assets/53734a4e-edbe-42b1-8bcb-d291b5679565" />

Then we can search for URLS
We can do this by selecting "Extract URLs"
<img width="995" height="555" alt="image" src="https://github.com/user-attachments/assets/460d6e7a-be5a-4a3e-b843-ea186a29dc45" />

We can also use CyberChef to "De-Fang", URLS making them no longer clickable as hyperlinks
Often done for security purposes when we're writing a report and including the malicious hyperlink that are sometimes automatically converted

<img width="987" height="549" alt="image" src="https://github.com/user-attachments/assets/0feaa62f-5ad7-46aa-be61-f94e81cdd446" />

### Tools that can do this for us to save us manual work

Email IOC Extractor

<img width="985" height="543" alt="image" src="https://github.com/user-attachments/assets/af68e584-85e1-45e1-a9c3-a08136ac2a6e" />

To Download:
<img width="1890" height="1101" alt="image" src="https://github.com/user-attachments/assets/ac76ec4d-1d08-4e2d-80b3-1c4b6876cd3b" />
<img width="749" height="494" alt="image" src="https://github.com/user-attachments/assets/b13f2fb6-d7d1-4131-83af-e2b46186c3d8" />

<img width="575" height="397" alt="image" src="https://github.com/user-attachments/assets/83f9ead4-c768-4c1c-b813-7e2ba6d41c2d" />

<img width="745" height="586" alt="image" src="https://github.com/user-attachments/assets/f3579ff1-5cdf-4116-9a33-7564ee8c7bd0" />
Extacts IP addresses from headers
Even performs IP lookup to get AS number and location of IP address

Extracted URLS
Shows same output in defanged format

*This method is not foolproof*

Step 2: Once we've extracted URLs, we can analyze them and perform reputation checks to determine if malicious

We can use tools but again, not foolproof. Have use use critical thinking and judgement. 

### URL2PNG
You use URL2PNG so you can see what a site looks like without actually visiting it.
Allows us to assess content, design and layout of site
Grab screenshot to put in reports or tickets

<img width="982" height="835" alt="image" src="https://github.com/user-attachments/assets/7e3f9213-156f-4718-bd4e-ec17c9dead04" />

Must compliment tool with other analysis methods

### URLScan.io
Online sandboxing tool that allows us to analyze and inspect behavior of URLs in a controlled enviornment
Ability to provide detailed reports from the analyzed URLs behavior
Reports scan include reputation score of the domain or verficts based on previous reports and scanning
Can also get a screenshot of site as well

Want to set to private scan if dealing with real data
<img width="974" height="547" alt="image" src="https://github.com/user-attachments/assets/f057f177-b46b-488e-8c8f-8f16e4fd5c4a" />


### VirusTotal

Can aggregate multiple antivirus engines and other security products or tools to scan files, URLs or hashes for potential threats

In details tab can get:
final URL in case of any redirects
serving IP address
hash in SHA-256 of the body of the http response that was sent back from server

As well as response headers

### URLvoid

Helps detect potentially malicious websites and perform checks on websites domain and URL reputation
Run URL through 30 block list engines and website reputation services

### Wannabrowser

Simulate browser and get response from suspcious webpage

Methodology: We need to collect artifcats in the form of URLS and check reputation against known sources.
As wll as yuse our own analysis to determine if they are safe to open.
















